sleepLength = 30
digBlock = {name = "ExtraUtilities:plant/ender_lilly", metadata = 7}
goalItem = "minecraft:ender_pearl"
goalSeed = "ExtraUtilities:plant/ender_lilly"

local function digIt()
	local success, data = turtle.inspectDown()
	if success and data.name == digBlock.name and data.metadata == digBlock.metadata then
		turtle.select(1)
		turtle.digDown()
		sleep(0.3)
		for i=1, 16 do
			local data = turtle.getItemDetail(i)
			if data ~= nil and data.name == goalItem then
				turtle.select(i)
				turtle.dropUp()
			end
		end
		sleep(0.3)
		if goalSeed ~= nil then
			for i=1, 16 do
				local data = turtle.getItemDetail(i)
				if data ~= nil and data.name == goalItem then
					turtle.select(i)
					turtle.placeDown()
					return
				end
			end
		end
	end
	sleep(sleepLength)
end

term.clear()
term.setCursorPos(1,1)
print("Mellon, mon!")
print("Waiting for ".. digBlock.name.. ":".. digBlock.metadata)
if goalSeed ~= nil then print("Replanting ".. goalSeed) end
print("ctrl+R to reboot, bah-ee!")

while true do
	digIt()
end